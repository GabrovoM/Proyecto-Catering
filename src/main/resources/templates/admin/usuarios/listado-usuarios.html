<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title th:text="${titulo}">Título</title>
	<link href="/webjars/bootstrap/5.3.3/css/bootstrap.min.css" rel="stylesheet">
	<link rel="icon" type="image/png" href="/img/favicon.png" sizes="64x64">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/styles_admin.css">
</head>

<body>
	<h1 class="text-center mb-5">Gestión de contenidos</h1>
	<div th:insert="~{admin/fragmentos::horizontal-nav}"></div>
	<div class="container-fluid">
		<div class="sidebar-container col-3 d-none d-md-block fixed-sidebar">
			<div th:insert="~{admin/fragmentos::vertical-nav}"></div>
		</div>
		<div class="col-9 content-area">
			<div class="col-9-content">				
				<a th:if="${currentPage == 'role-user'}" th:href="@{/admin/usuario/download-csv/role-user}"
					class="btn btn-light border rounded mb-4 " style="padding: 10px;">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
						class="bi bi-filetype-csv" viewBox="0 0 16 16">
						<path fill-rule="evenodd"
							d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM3.517 14.841a1.13 1.13 0 0 0 .401.823q.195.162.478.252.284.091.665.091.507 0 .859-.158.354-.158.539-.44.187-.284.187-.656 0-.336-.134-.56a1 1 0 0 0-.375-.357 2 2 0 0 0-.566-.21l-.621-.144a1 1 0 0 1-.404-.176.37.37 0 0 1-.144-.299q0-.234.185-.384.188-.152.512-.152.214 0 .37.068a.6.6 0 0 1 .246.181.56.56 0 0 1 .12.258h.75a1.1 1.1 0 0 0-.2-.566 1.2 1.2 0 0 0-.5-.41 1.8 1.8 0 0 0-.78-.152q-.439 0-.776.15-.337.149-.527.421-.19.273-.19.639 0 .302.122.524.124.223.352.367.228.143.539.213l.618.144q.31.073.463.193a.39.39 0 0 1 .152.326.5.5 0 0 1-.085.29.56.56 0 0 1-.255.193q-.167.07-.413.07-.175 0-.32-.04a.8.8 0 0 1-.248-.115.58.58 0 0 1-.255-.384zM.806 13.693q0-.373.102-.633a.87.87 0 0 1 .302-.399.8.8 0 0 1 .475-.137q.225 0 .398.097a.7.7 0 0 1 .272.26.85.85 0 0 1 .12.381h.765v-.072a1.33 1.33 0 0 0-.466-.964 1.4 1.4 0 0 0-.489-.272 1.8 1.8 0 0 0-.606-.097q-.534 0-.911.223-.375.222-.572.632-.195.41-.196.979v.498q0 .568.193.976.197.407.572.626.375.217.914.217.439 0 .785-.164t.55-.454a1.27 1.27 0 0 0 .226-.674v-.076h-.764a.8.8 0 0 1-.118.363.7.7 0 0 1-.272.25.9.9 0 0 1-.401.087.85.85 0 0 1-.478-.132.83.83 0 0 1-.299-.392 1.7 1.7 0 0 1-.102-.627zm8.239 2.238h-.953l-1.338-3.999h.917l.896 3.138h.038l.888-3.138h.879z" />
					</svg>
				</a>
				<a th:if="${currentPage == 'not-role-user'}" th:href="@{/admin/usuario/download-csv/not-role-user}"
					class="btn btn-light border rounded mb-4 " style="padding: 10px;">
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
						class="bi bi-filetype-csv" viewBox="0 0 16 16">
						<path fill-rule="evenodd"
							d="M14 4.5V14a2 2 0 0 1-2 2h-1v-1h1a1 1 0 0 0 1-1V4.5h-2A1.5 1.5 0 0 1 9.5 3V1H4a1 1 0 0 0-1 1v9H2V2a2 2 0 0 1 2-2h5.5zM3.517 14.841a1.13 1.13 0 0 0 .401.823q.195.162.478.252.284.091.665.091.507 0 .859-.158.354-.158.539-.44.187-.284.187-.656 0-.336-.134-.56a1 1 0 0 0-.375-.357 2 2 0 0 0-.566-.21l-.621-.144a1 1 0 0 1-.404-.176.37.37 0 0 1-.144-.299q0-.234.185-.384.188-.152.512-.152.214 0 .37.068a.6.6 0 0 1 .246.181.56.56 0 0 1 .12.258h.75a1.1 1.1 0 0 0-.2-.566 1.2 1.2 0 0 0-.5-.41 1.8 1.8 0 0 0-.78-.152q-.439 0-.776.15-.337.149-.527.421-.19.273-.19.639 0 .302.122.524.124.223.352.367.228.143.539.213l.618.144q.31.073.463.193a.39.39 0 0 1 .152.326.5.5 0 0 1-.085.29.56.56 0 0 1-.255.193q-.167.07-.413.07-.175 0-.32-.04a.8.8 0 0 1-.248-.115.58.58 0 0 1-.255-.384zM.806 13.693q0-.373.102-.633a.87.87 0 0 1 .302-.399.8.8 0 0 1 .475-.137q.225 0 .398.097a.7.7 0 0 1 .272.26.85.85 0 0 1 .12.381h.765v-.072a1.33 1.33 0 0 0-.466-.964 1.4 1.4 0 0 0-.489-.272 1.8 1.8 0 0 0-.606-.097q-.534 0-.911.223-.375.222-.572.632-.195.41-.196.979v.498q0 .568.193.976.197.407.572.626.375.217.914.217.439 0 .785-.164t.55-.454a1.27 1.27 0 0 0 .226-.674v-.076h-.764a.8.8 0 0 1-.118.363.7.7 0 0 1-.272.25.9.9 0 0 1-.401.087.85.85 0 0 1-.478-.132.83.83 0 0 1-.299-.392 1.7 1.7 0 0 1-.102-.627zm8.239 2.238h-.953l-1.338-3.999h.917l.896 3.138h.038l.888-3.138h.879z" />
					</svg>
				</a>
				<div th:if="${currentPage == 'not-role-user'}">
					<a th:href="@{/admin/usuario/nuevo}" class="btn btn-custom-success mb-3">Nuevo usuario</a>
				</div>

				<div th:if="${message}" class="alert alert-success d-flex justify-content-between" role="alert">
					<span th:text="${message}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
				<div th:if="${error}" class="alert alert-danger d-flex justify-content-between" role="alert">
					<span th:text="${error}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>			
				<div class="row table-responsive">
					<table class="table table-hover">
						<thead class="table-dark bg-info text-white">
							<tr>
								<th>Id</th>
								<th scope="col">Nombre</th>
								<th scope="col">Localidad</th>
								<th scope="col">Email</th>
								<th scope="col">Username</th>
								<th scope="col" th:if="${showRoleColumn}">Roles</th>
								<th scope="col" th:if="${isClientList}">Pedidos</th>
								<th scope="col">Editar</th>
								<th scope="col">Borrar</th>
							</tr>
						</thead>
						<tbody>
							<tr th:if="${usuariosPage.content.empty}">
								<td colspan="6">No hay usuarios</td>
							</tr>
							<tr th:each="usuario : ${usuariosPage.content}">
								<td><span th:text="${usuario.id}">Id</span></td>
								<td><span th:text="${usuario.nombre}"></span></td>
								<td><span th:text="${usuario.localidad}"></span></td>
								<td><span th:text="${usuario.email}"></span></td>
								<td><span th:text="${usuario.username}"></span></td>
								<td th:if="${showRoleColumn}">
									<span th:each="role, iterStat : ${usuario.roles}">
										<span th:text="${#strings.replace(role.rol.roleName, 'ROLE_', '')}"></span>
										<span th:if="${iterStat.index < usuario.roles.size() - 1}">, </span>
										
									</span>
								</td>
								<td th:if="${isClientList}">
									<a th:href="@{/admin/usuario/pedidosUsuario/{id}(id=${usuario.id}, pageUsuarios=${pageUsuarios != null ? pageUsuarios : 0})}"
										class="btn btn-outline-primary btn-sm d-flex align-items-center justify-content-center"
										id="link-pedidos">
										<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
											fill="currentColor" class="bi bi-basket" viewBox="0 0 16 16">
											<path
												d="M5.757 1.071a.5.5 0 0 1 .172.686L3.383 6h9.234L10.07 1.757a.5.5 0 1 1 .858-.514L13.783 6H15a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1v4.5a2.5 2.5 0 0 1-2.5 2.5h-9A2.5 2.5 0 0 1 1 13.5V9a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1.217L5.07 1.243a.5.5 0 0 1 .686-.172zM2 9v4.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V9zM1 7v1h14V7zm3 3a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 4 10m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 6 10m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3A.5.5 0 0 1 8 10m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5m2 0a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 1 .5-.5" />
										</svg>
									</a>
								</td>
								<td th:if="${usuario.hasRole('ROLE_USER')}">
									<a th:href="@{/admin/usuario/edit/cliente/{id}(id=${usuario.id})}"
										class="btn btn-custom-success btn-sm">
										<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
											fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
											<path
												d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
											<path fill-rule="evenodd"
												d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z" />
										</svg>
									</a>
								</td>
								<td th:if="${!usuario.hasRole('ROLE_USER')}">
									<a th:href="@{/admin/usuario/edit/usuario/{id}(id=${usuario.id})}"
										class="btn btn-custom-success btn-sm">
										<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
											fill="currentColor" class="bi bi-pencil-square" viewBox="0 0 16 16">
											<path
												d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z" />
											<path fill-rule="evenodd"
												d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z" />
										</svg>
									</a>
								</td>

								<td>
									<!-- Delete button opens the modal -->
									<button type="button" class="btn btn-custom-danger btn-sm text-white"
										data-bs-toggle="modal" data-bs-target="#modal-delete_usuario"
										th:data-id="${usuario.id}" th:data-nombre="${usuario.nombre}"
										th:data-role="${usuario.hasRole('ROLE_USER') ? 'cliente' : 'usuario'}"
										th:if="${!usuario.hasRole('ROLE_ADMIN')}"> <!-- Hide button if user is ADMIN -->
										<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
											fill="currentColor" class="bi bi-trash" viewBox="0 0 16 16">
											<path
												d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z" />
											<path
												d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z" />
										</svg>
									</button>
								</td>

							</tr>
						</tbody>
					</table>

					<div th:if="${errorMessage}" class="alert alert-warning alert-dismissible fade show">
						<p th:text="${errorMessage}"></p>
						<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
					</div>

					<!-- Modal -->
					<div class="modal fade" id="modal-delete_usuario" tabindex="-1" aria-labelledby="exampleModalLabel"
						aria-hidden="true">
						<div class="modal-dialog">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="exampleModalLabel">Confirmar Borrado</h5>
									<button type="button" class="btn-close" data-bs-dismiss="modal"
										aria-label="Close"></button>
								</div>
								<div class="modal-body">
									<p>¿Borrar el <span id="tipo-usuario">Usuario</span> <span
											id="usuario-nombre">Nombre
											Usuario</span>?</p>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary"
										data-bs-dismiss="modal">Cerrar</button>
									<a id="confirm-delete" href="#" class="btn btn-danger">Borrar</a>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row mb-1" th:if="${usuariosPage != null and usuariosPage.totalPages > 1}">
					<nav aria-label="Page navigation">
						<ul class="pagination justify-content-end">						
							<li class="page-item" th:class="${usuariosPage.number == 0 ? 'disabled' : ''}">
								<a class="page-link" th:href="@{/admin/usuario/role-user(pageUsuarios=1)}">&laquo;</a>
							</li>						
							<li class="page-item" th:class="${usuariosPage.hasPrevious() ? '' : 'disabled'}">
								<a class="page-link"
									th:href="@{/admin/usuario/role-user(pageUsuarios=${usuariosPage.number})}"
									th:disabled="${!usuariosPage.hasPrevious()}">Anterior</a>
							</li>
							<li class="page-item disabled d-none d-sm-block">
								<span class="page-link">
									Página <strong th:text="${usuariosPage.number + 1}"></strong> de <strong
										th:text="${usuariosPage.totalPages}"></strong>
								</span>
							</li>
							<li class="page-item"
								th:class="${usuariosPage.number + 1 == usuariosPage.totalPages ? 'disabled' : ''}">
								<a class="page-link"
									th:href="@{/admin/usuario/role-user(pageUsuarios=${usuariosPage.number + 2})}"
									th:disabled="${usuariosPage.number + 1 == usuariosPage.totalPages}">Siguiente</a>
							</li>
							<li class="page-item"
								th:class="${usuariosPage.number == usuariosPage.totalPages - 1 ? 'disabled' : ''}">
								<a class="page-link"
									th:href="@{/admin/usuario/role-user(pageUsuarios=${usuariosPage.totalPages})}">&raquo;</a>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</div>
	</div>
	<th:block th:insert="~{admin/fragmentos::footer}"></th:block>

	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
		integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
		crossorigin="anonymous"></script>
	<script src="/webjars/jquery/3.7.1/jquery.min.js"></script>
	<script src="/webjars/bootstrap/5.3.3/js/bootstrap.min.js"></script>
	<script th:src="@{/js/app.js}"></script>

</body>

</html>